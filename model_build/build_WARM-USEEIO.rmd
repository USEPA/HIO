---
title: "build_WARM-USEEIO"
output: html_notebook
---

```{r}
# install.packages("renv")  # must have renv installed in root env
# renv::activate()
# renv::restore(lockfile="WARMer.lock")

# devtools::install_github("USEPA/useeior@hybridization")
# devtools::load_all(".")
# library('useeior')

# Build model from specs
configpaths <- file.path("data", c("USEEIO-WARM.yml",
                                   "WARMv15.yml"))
modelname <- "USEEIO-WARM"
model <- buildModel(modelname, configpaths)

writeModeltoXLSX(model, file.path(rappdirs::user_data_dir(),
                                  "useeior/Model_Builds"))
printValidationResults(model)

# Source demand vector from csv
demand_path <- file.path("data", "material_demand.csv")
y <- extractAndFormatDemandVector(demand_path, 'Grains', model)


# Or create demand vector in code
y2 <- setNames(c(1, 2), c("WARM07/US", "WARM08/US"))
y2 <- formatDemandVector(y2, model$L)

# Generate results
results <- calculateEEIOModel(model, perspective = "DIRECT", y)
results <- append(calculateEEIOModel(model, perspective = "FINAL", y), results)

lcia <- results[["LCIA_f"]]
print(lcia[rowSums(lcia[])>0,])

lci <- results[["LCI_f"]]
print(lci[rowSums(lci[])>0,])


impact_result <- calculateSectorPurchasedbySectorSourcedImpact(y, model, "Greenhouse Gases")
a <- calculateSectorContributiontoImpact(model, "WARM01/US", "Greenhouse Gases")


```
